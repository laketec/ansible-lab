---
# =============================================================================
# DEMO STEP 4: Configure SNMPv3 Monitoring
# =============================================================================
# This playbook configures secure SNMPv3 with SHA auth and AES encryption
# Shows: Security-focused configuration using variables from group_vars
# Run: ansible-playbook playbooks/04_configure_snmpv3.yml
# =============================================================================

- name: "STEP 4: Configure SNMPv3 on AOS-CX Switches"
  hosts: aoscx_switches
  gather_facts: false
  connection: network_cli
  
  vars_files:
    - ../group_vars/aoscx_switches.yml
  
  tasks:
    - name: "Display SNMPv3 configuration to be applied"
      ansible.builtin.debug:
        msg: |
          Configuring SNMPv3 on {{ inventory_hostname }}:
            User: {{ snmpv3_user }}
            Auth: {{ snmpv3_auth_protocol | upper }}
            Priv: {{ snmpv3_priv_protocol | upper }}

    - name: "Configure SNMPv3 user with authentication and privacy"
      arubanetworks.aoscx.aoscx_config:
        lines:
          - snmpv3 user {{ snmpv3_user }} auth {{ snmpv3_auth_protocol }} auth-pass plaintext {{ snmpv3_auth_pass }} priv {{ snmpv3_priv_protocol }} priv-pass plaintext {{ snmpv3_priv_pass }}
          
    - name: "Enable SNMP server on default VRF"
      arubanetworks.aoscx.aoscx_config:
        lines:
          - snmp-server vrf default
          - snmpv3 enable
          
    - name: "Configure SNMP system information"
      arubanetworks.aoscx.aoscx_config:
        lines:
          - snmp-server system-location "Laketec Demo Lab"
          - snmp-server system-contact "noc@laketec.com"
          
    - name: "Verify SNMPv3 configuration"
      arubanetworks.aoscx.aoscx_command:
        commands:
          - show snmpv3 users
      register: snmp_output
      
    - name: "Display SNMPv3 verification"
      ansible.builtin.debug:
        msg: "{{ snmp_output.stdout_lines[0] }}"

- name: "Summary"
  hosts: localhost
  gather_facts: false
  
  vars_files:
    - ../group_vars/aoscx_switches.yml
    
  tasks:
    - name: "SNMPv3 configuration complete"
      ansible.builtin.debug:
        msg: |
          
          ================================================================
                        SNMPv3 CONFIGURATION COMPLETE
          ================================================================
          
          Configured on {{ groups["aoscx_switches"] | length }} switches
          
          SNMPv3 Settings:
            - User:           {{ snmpv3_user }}
            - Authentication: SHA (Secure Hash Algorithm)
            - Privacy:        AES (Advanced Encryption Standard)
            - Location:       Laketec Demo Lab
            - Contact:        noc@laketec.com
          
          ================================================================
