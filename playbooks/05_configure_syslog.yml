---
# =============================================================================
# DEMO STEP 5: Configure Centralized Syslog
# =============================================================================
# This playbook configures syslog forwarding to a central server
# Shows: Centralized logging for compliance and troubleshooting
# Run: ansible-playbook playbooks/05_configure_syslog.yml
# =============================================================================

- name: "STEP 5: Configure Syslog on AOS-CX Switches"
  hosts: aoscx_switches
  gather_facts: false
  connection: network_cli
  
  vars_files:
    - ../group_vars/aoscx_switches.yml
  
  tasks:
    - name: "Display Syslog configuration to be applied"
      ansible.builtin.debug:
        msg: |
          Configuring Syslog on {{ inventory_hostname }}:
            Server:   {{ syslog_server }}
            Facility: {{ syslog_facility }}
            Severity: {{ syslog_severity }}

    - name: "Configure syslog remote server"
      arubanetworks.aoscx.aoscx_config:
        lines:
          - logging {{ syslog_server }} vrf default
          - logging facility {{ syslog_facility }}
          - logging severity {{ syslog_severity }}
          
    - name: "Enable logging of configuration changes"
      arubanetworks.aoscx.aoscx_config:
        lines:
          - logging origin-id hostname
          
    - name: "Verify syslog configuration"
      arubanetworks.aoscx.aoscx_command:
        commands:
          - show logging
      register: syslog_output
      
    - name: "Display syslog status"
      ansible.builtin.debug:
        msg: "Syslog configured successfully on {{ inventory_hostname }}"

- name: "Summary"
  hosts: localhost
  gather_facts: false
  
  vars_files:
    - ../group_vars/aoscx_switches.yml
    
  tasks:
    - name: "Syslog configuration complete"
      ansible.builtin.debug:
        msg: |
          
          ================================================================
                        SYSLOG CONFIGURATION COMPLETE
          ================================================================
          
          Configured on {{ groups["aoscx_switches"] | length }} switches
          
          Syslog Settings:
            - Server:   {{ syslog_server }}
            - Facility: {{ syslog_facility }}
            - Severity: {{ syslog_severity }}
          
          All switches now sending logs to central syslog server!
          
          ================================================================
